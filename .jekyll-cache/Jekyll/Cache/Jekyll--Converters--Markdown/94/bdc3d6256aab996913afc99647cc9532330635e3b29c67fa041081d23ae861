I"<h3 id="flush"><u>flush</u></h3>
<p>앞에서 영속성 컨텍스트가 Entity 를 관리하는 방식에 대해서 살펴봤다.<br /></p>

<p>영속성 컨텍스트의 내용은 <code class="language-plaintext highlighter-rouge">flush</code> 가 발생하면서 DB에 해당 내용이 반영 된다.<br />
이때, flush 가 발생한다고 해서 영속성 컨텍스트의 내용이 비워지는 것은 아니다.<br />
단지 <code class="language-plaintext highlighter-rouge">영속성 컨텍스트의 변경사항을 DB와 동기화</code> 하는 것 뿐이다.<br /></p>

<p>영속성 컨텍스트를 flush 하는 방법은 아래와 같다.</p>
<ul>
  <li>em.flush()</li>
  <li>트랜젝션 커밋</li>
  <li>JPQL 등 EntityManager 를 통해 SQL 을 실행하는 경우<br />
(DB에 내용이 반영되어야 정상적인 결과가 나오기 때문에 쿼리 수행 전 미리 DB에 내용을 반영함)</li>
</ul>

<h3 id="영속성-컨텍스트의-이점"><u>영속성 컨텍스트의 이점</u></h3>

<p>영속성 컨텍스트를 사용함으로써 다음과 같은 이점을 얻을 수 있다.</p>

<ol>
  <li>
    <p>1차 캐시 지원에 따른 성능 향상<br />
Entity 조회 시 1차 캐시에 존재하는 경우 DB에 Select SQL 없이 바로 조회 가능하다.<br />
이를 통해 약간의 성능 향상을 기대할 수 있다.</p>
  </li>
  <li>
    <p>쓰기지연<br />
commit 이전까지는 관련 SQL 을 DB로 보내지 않기 때문에 대량 처리 등이 가능하다.</p>
  </li>
  <li>
    <p>변경감지(Dirty Checking)<br />
flush 관련…</p>
  </li>
  <li>
    <p>지연로딩(Lazy Loading)<br /></p>
  </li>
  <li>
    <p>동일성(Identity) 보장<br />
동일 ID의 Entity 를 반복 조회하는 경우, 1차 캐시에 존재하면 해당 Entity 를 리턴하고<br />
존재하지 않으면 최초 DB 조회 후 리턴하고, 해당 Entity 를 1차 캐시에 저장하기 때문에<br />
아래의 결과는 항상 <code class="language-plaintext highlighter-rouge">true</code> 가 된다.</p>
  </li>
</ol>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Member</span> <span class="n">a</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Member</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">"member1"</span><span class="o">);</span>
<span class="nc">Member</span> <span class="n">b</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Member</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">"member1"</span><span class="o">);</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="o">);</span>
</code></pre></div></div>

<blockquote>
  <p>Reference : <a href="https://www.inflearn.com/course/ORM-JPA-Basic/dashboard">인프런 [자바 ORM 표준 JPA 프로그래밍 - 기본편] by 김영한</a></p>
</blockquote>
:ET